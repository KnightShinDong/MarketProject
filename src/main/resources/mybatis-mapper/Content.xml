<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.hsl.sns.dao.IDao">
	<resultMap type="com.hsl.sns.dto.PostDto" id="PostDto">
		<result property="postidx" column="postidx"/>
		<result property="id" column="id"/>
		<result property="title" column="title"/>
		<result property="type" column="type"/>
		<result property="price" column="price"/>
		<result property="tradeplace" column="tradeplace"/>
		<result property="content" column="content"/>
		<result property="createdate" column="createdate"/>
		<result property="nick" column="nick"/>
		
	</resultMap>
	
	<resultMap type="com.hsl.sns.dto.PostingUrlDto" id="PostingUrlDto2">
		<result property="postingimgurlidx" column="postingimgurlidx"/>
		<result property="postidx" column="postidx"/>
		<result property="fileOriName" column="fileOriName"/>
		<result property="fileName" column="fileName"/>
		<result property="fileExtension" column="fileExtension"/>
		<result property="fileUrl" column="fileUrl"/>
		<result property="createdate" column="createdate"/>
		<result property="updatedate" column="updatedate"/>
		<result property="createTime" column="createTime"/>	

		<collection property="postDto" resultMap="PostDto"></collection>
	</resultMap>
	
	<resultMap type="com.hsl.sns.dto.MemberDto" id="MemberDto">
		<result property="id" column="id"/>
		<result property="pwd" column="pwd"/>
		<result property="name" column="name"/>
		<result property="birth" column="birth"/>
		<result property="mail" column="mail"/>
		<result property="phone" column="phone"/>
		<result property="nick" column="nick"/>
		<result property="rdate" column="rdate"/>
		<result property="profile" column="profile"/>
		<result property="greet" column="greet"/>	

		<collection property="postDto" resultMap="PostDto"></collection>
	</resultMap>
	
	<resultMap type="com.hsl.sns.dto.FollowDto" id="FollowDto">
		<result property="followidx" column="followidx"/>
		<result property="followcontent" column="followcontent"/>
		<result property="followid" column="followid"/>

		<collection property="postDto" resultMap="PostDto"></collection>
	</resultMap>


	
	<!-- contnetWrite -->
	<insert id="contentWriteContDao">
		INSERT INTO post (postidx, title, type, price, tradeplace,content, id) 
			VALUES (post_seq.nextval, #{param1}, #{param2},#{param3},#{param4},#{param5},#{param6})
			
			 
	</insert>	
		
	<insert id="contentWritePicDao">	
		INSERT INTO posturl (postingimgurlidx, postidx, fileOriName, fileName, fileExtension, fileUrl) 
			VALUES (postingurl_seq.nextval,#{param1},#{param2},#{param3},#{param4},#{param5})
	</insert>
	
	<select id="postInfoDao" resultType="com.hsl.sns.dto.PostDto">
		SELECT * FROM post WHERE id=#{param1} ORDER BY postidx DESC
	</select>
	
	<!-- 판매중 게시글 수 -->
	<select id="postCountDao" resultType="int">
		SELECT count(*) FROM post WHERE id=#{param1}
	</select>

	<!-- index -->
	<select id="postListDao" resultType="com.hsl.sns.dto.PostDto">
		SELECT p.*,u.nick FROM post p JOIN user_sns u ON p.id = u.id ORDER BY p.postidx DESC
	</select>
	<select id="postUrlListDao" resultType="com.hsl.sns.dto.PostingUrlDto">
		SELECT r.*, p.*FROM posturl r, post p
		WHERE r.postidx = p.postidx
		
	</select>
	<select id="postViewDao" parameterType="com.hsl.sns.dto.PostingUrlDto" resultMap="PostingUrlDto2">
		SELECT r.*, p.*,u.nick FROM posturl r, post p, user_sns u
		WHERE r.postidx = p.postidx
		AND  p.id= u.id ORDER BY p.postidx
	</select>
	
	<!-- tradeView 정보 불러오기 -->
	<select id="postInfomationDao" parameterType="com.hsl.sns.dto.MemberDto" resultMap="MemberDto">
		SELECT u.* ,p.title, p.type, p.price, p.tradeplace FROM user_sns u LEFT JOIN post p ON u.id = p.id WHERE postidx=#{param1}
	</select>
	
	<!-- 찜한 게시물 목록  -->
	<select id="likeContentListDao" parameterType="com.hsl.sns.dto.FollowDto" resultMap="FollowDto">
		SELECT * FROM follow f LEFT JOIN post p ON f.followcontent = p.postidx WHERE followid=#{param1}
	</select>
	
	<!-- 판매중인 게시물 목록 -->
	<select id="myPostListDao" resultType="com.hsl.sns.dto.PostDto">
		SELECT * FROM post WHERE id=#{param1}
	</select>
	
	<!-- 찜,구매,판매 썸네일 이미지 하나만 가져오기 -->
	<select id="myPostUrlListDao" parameterType="com.hsl.sns.dto.PostingUrlDto" resultMap="PostingUrlDto2">
		SELECT p.postidx,max(u.filename) as filename FROM posturl u INNER JOIN post p ON p.postidx = u.postidx GROUP BY p.postidx
	</select>
	
	<select id="postDao" resultType="com.hsl.sns.dto.PostDto">
		SELECT p.*, u.nick FROM post p join user_sns u ON p.id = u.id WHERE postidx=${param1}
	</select>
	
</mapper>
	
